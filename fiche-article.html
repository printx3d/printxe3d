<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fiche Article - Printxe3D</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    body { background: #111; color: #fff; font-family: Inter, Arial, sans-serif; margin: 0; }
    .container { max-width: 600px; margin: 40px auto; background: #222; border-radius: 16px; box-shadow: 0 8px 32px #0004; padding: 32px 24px; }
    h2 { color: #D7FF2F; margin-top: 0; }
    .product-img { width: 100%; max-width: 320px; height: 220px; object-fit: cover; border-radius: 12px; background: #333; margin: 0 auto 18px auto; display: block; }
    .info { margin-bottom: 18px; }
    .title { font-weight: bold; font-size: 1.2em; margin-bottom: 6px; }
    .desc { color: #ccc; margin-bottom: 10px; }
    .price { color: #D7FF2F; font-size: 1.1em; font-weight: bold; margin-bottom: 10px; }
    .qty-row { display: flex; align-items: center; gap: 10px; margin-bottom: 14px; }
    .qty-row label { font-weight: bold; }
    .qty-row input { width: 60px; padding: 6px; border-radius: 6px; border: none; background: #181818; color: #fff; text-align: center; }
    .actions { display: flex; gap: 10px; margin-top: 18px; }
    .actions button { flex: 1; padding: 12px 0; font-size: 1.1em; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
    .add { background: #D7FF2F; color: #111; }
    .add:hover { background: #eaff5f; }
    .buy { background: #333; color: #D7FF2F; }
    .buy:hover { background: #444; }
  </style>
</head>
<body>
  <div class="container fiche-grid">
    <div class="fiche-gallery">
      <div class="fiche-thumbs-vertical" id="thumbs"></div>
      <div class="fiche-main-img fiche-main-img-large fade-in"><img id="mainImg" src="" alt="Image principale produit"></div>
    </div>
    <div class="fiche-info">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h1 class="fiche-title" id="title"></h1>
        <button id="backToSite" class="fiche-back">Retour au site web</button>
      </div>
      <div class="fiche-rating">
        <span id="stars"></span>
        <span id="reviewsCount" class="fiche-reviews"></span>
      </div>
      <div class="fiche-short-desc" id="desc"></div>
      <div class="fiche-options">
        <div class="fiche-option">
          <div class="fiche-label">Couleur</div>
          <div class="fiche-colors" id="colorOptions"></div>
        </div>
        <div class="fiche-option">
          <div class="fiche-label">Matière</div>
          <div class="fiche-mats" id="matOptions"></div>
        </div>
      </div>
      <div class="fiche-qty-row">
        <button class="fiche-qty-btn" id="qtyMinus">–</button>
        <span id="qty">1</span>
        <button class="fiche-qty-btn" id="qtyPlus">+</button>
      </div>
      <div class="fiche-price-row">
        <span class="fiche-price" id="price"></span>
      </div>
      <div class="fiche-actions">
        <button class="fiche-add" id="addToCart"><i class="fas fa-shopping-cart"></i> Ajouter au panier</button>
        <button class="fiche-buy" id="buyNow">Acheter maintenant</button>
      </div>
    </div>
  </div>
  
  <style>
    body { background: #111; color: #fff; font-family: Inter, Arial, sans-serif; margin: 0; }
    .container.fiche-grid { display: grid; grid-template-columns: 1.1fr 1fr; gap: 36px; max-width: 1100px; margin: 40px auto 0 auto; background: #181818; border-radius: 18px; box-shadow: 0 8px 32px #0002; padding: 36px 32px; }
    .fiche-gallery {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      gap: 28px;
      min-height: 520px;
    }
    .fiche-main-img {
      width: 480px;
      height: 480px;
      background: #232323;
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 16px #0003;
      overflow: hidden;
    }
    .fiche-main-img-large {
      width: 520px;
      height: 520px;
      max-width: 90vw;
      max-height: 90vw;
    }
    .fiche-main-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 18px;
    }
    .fiche-thumbs-vertical {
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-top: 0;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .fiche-thumbs-vertical img {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 10px;
      border: 2px solid #232323;
      cursor: pointer;
      transition: border .18s;
    }
    .fiche-thumbs-vertical img.selected {
      border: 2px solid #D7FF2F;
    }
    .fiche-info { display: flex; flex-direction: column; gap: 10px; }
    .fiche-title { font-size: 1.5rem; font-weight: 800; color: #D7FF2F; margin: 0; }
    .fiche-back { background: #D7FF2F; color: #111; font-weight: 700; border: none; border-radius: 8px; padding: 8px 18px; cursor: pointer; font-size: 1em; }
    .fiche-rating { display: flex; align-items: center; gap: 8px; font-size: 1.1em; color: #ffe066; margin-bottom: 4px; }
    .fiche-reviews { color: #bfbfbf; font-size: 0.98em; }
    .fiche-short-desc { color: #ccc; font-size: 1.08em; margin-bottom: 8px; }
    .fiche-options { display: flex; flex-wrap: wrap; gap: 18px; margin: 18px 0 8px 0; }
    .fiche-option { display: flex; flex-direction: column; gap: 6px; }
    .fiche-label { font-weight: 700; color: #fff; font-size: 1em; margin-bottom: 2px; }
    .fiche-colors { display: flex; gap: 8px; }
    .fiche-color { width: 28px; height: 28px; border-radius: 50%; border: 2px solid #232323; cursor: pointer; display: flex; align-items: center; justify-content: center; position: relative; transition: border .18s; }
    .fiche-color.selected { border: 2px solid #D7FF2F; }
    .fiche-color .check { position: absolute; color: #fff; font-size: 1.1em; left: 6px; top: 4px; }
    .fiche-mats { display: flex; gap: 10px; }
    .fiche-mat { background: #232323; border-radius: 10px; padding: 8px 16px; cursor: pointer; border: 2px solid #232323; color: #fff; font-weight: 600; font-size: 1em; display: flex; flex-direction: column; align-items: flex-start; min-width: 80px; transition: border .18s; }
    .fiche-mat.selected { border: 2px solid #D7FF2F; color: #D7FF2F; }
    .fiche-mat-sup { color: #D7FF2F; font-size: 0.95em; font-weight: 700; margin-top: 2px; }
    .fiche-mat-desc { color: #bfbfbf; font-size: 0.93em; margin-top: 2px; }
    .fiche-sizes { display: flex; gap: 10px; }
    .fiche-size { background: #232323; border-radius: 8px; padding: 7px 18px; cursor: pointer; border: 2px solid #232323; color: #fff; font-weight: 600; font-size: 1em; transition: border .18s; }
    .fiche-size.selected { border: 2px solid #D7FF2F; color: #D7FF2F; }
    .fiche-qty-row { display: flex; align-items: center; gap: 12px; margin: 18px 0 8px 0; }
    .fiche-qty-btn { background: #232323; color: #fff; border: none; border-radius: 8px; width: 36px; height: 36px; font-size: 1.3em; cursor: pointer; font-weight: 700; transition: background .18s; }
    .fiche-qty-btn:hover { background: #333; }
    .fiche-price-row { display: flex; align-items: center; gap: 18px; margin: 10px 0 18px 0; font-size: 1.3em; }
    .fiche-price { color: #D7FF2F; font-weight: 800; font-size: 1.3em; }
    .fiche-prod-time { color: #bfbfbf; font-size: 0.98em; }
    .fiche-actions { display: flex; gap: 12px; margin-top: 10px; }
    .fiche-add { background: #D7FF2F; color: #111; font-weight: 700; border: none; border-radius: 8px; padding: 12px 18px; cursor: pointer; font-size: 1.1em; display: flex; align-items: center; gap: 8px; }
    .fiche-add i { font-size: 1.1em; }
    .fiche-buy { background: #232323; color: #D7FF2F; font-weight: 700; border: 2px solid #D7FF2F; border-radius: 8px; padding: 12px 18px; cursor: pointer; font-size: 1.1em; }
    .fiche-long-desc { max-width: 900px; margin: 36px auto 0 auto; background: #232323; border-radius: 14px; color: #fff; font-size: 1.08em; padding: 28px 24px; box-shadow: 0 2px 12px #0002; }
    .fade-in { animation: fadeIn .7s cubic-bezier(.33,1.02,.47,.98) both; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: none; } }
    @media (max-width: 900px) {
      .container.fiche-grid { grid-template-columns: 1fr; gap: 18px; padding: 18px 4vw; }
      .fiche-main-img { width: 90vw; height: 260px; }
      .fiche-long-desc { padding: 18px 6vw; }
    }
    @media (max-width: 600px) {
      .container.fiche-grid { padding: 8px 2vw; }
      .fiche-main-img { width: 98vw; height: 180px; }
      .fiche-thumbs img { width: 40px; height: 40px; }
    }
  </style>
  <script>
    // --- Données de configuration pour les options ---
    const COLORS = [
      { name: 'Blanc', code: '#fff', sup: 0 },
      { name: 'Marbre', code: '#e5e5e5', sup: 1 },
      { name: 'Noir', code: '#222', sup: 0 },
      { name: 'Violet', code: '#a259e6', sup: 1 },
      { name: 'Beige', code: '#e2cfa5', sup: 0 }
    ];
    const MATS = [
      { name: 'PLA', sup: 0, desc: 'Classique, facile à imprimer.' },
      { name: 'PETG', sup: 1.5, desc: 'Résistant, usage extérieur.' },
      { name: 'ABS', sup: 2.5, desc: 'Solide, résiste à la chaleur.' }
    ];
    const SIZES = [
      { name: 'Petit', mul: 1 },
      { name: 'Moyen', mul: 1.4 },
      { name: 'Grand', mul: 1.9 }
    ];
    // --- Récupération du produit ---
    const data = localStorage.getItem('fiche_article');
    let article = null;
    try { article = JSON.parse(data); } catch(e) {}
    if (!article) {
      document.body.innerHTML = '<div style="text-align:center;padding:60px;font-size:1.3em">Aucun produit sélectionné.<br><a href=\'index.html#store\'>Retour boutique</a></div>';
    } else {
      // --- Initialisation des états ---
      let selectedColor = COLORS[0];
      let selectedMat = MATS[0];
      let selectedSize = SIZES[0];
      let qty = 1;
      // --- Galerie ---
      const mainImg = document.getElementById('mainImg');
      const thumbs = document.getElementById('thumbs');
      if (Array.isArray(article.images) && article.images.length) {
        mainImg.src = article.images[0];
        article.images.forEach((img, i) => {
          const im = document.createElement('img');
          im.src = img;
          im.alt = 'miniature ' + (i+1);
          if (i === 0) im.classList.add('selected');
          im.onclick = () => {
            mainImg.src = img;
            thumbs.querySelectorAll('img').forEach(e=>e.classList.remove('selected'));
            im.classList.add('selected');
          };
          thumbs.appendChild(im);
        });
      } else {
        mainImg.src = 'https://via.placeholder.com/520x520?text=Image+Produit';
      }
      // --- Titre, desc courtes, rating, avis ---
      document.getElementById('title').textContent = article.title || '';
      document.getElementById('desc').textContent = (article.description || '').split('<br>')[0];
      // Note et avis (données fictives si absentes)
      const rating = article.rating || 4.8;
      const reviews = article.reviews || Math.floor(20 + Math.random()*80);
      document.getElementById('stars').innerHTML = '★'.repeat(Math.round(rating)) + '<span style="color:#444">' + '★'.repeat(5-Math.round(rating)) + '</span>';
      document.getElementById('reviewsCount').textContent = `(${reviews} avis)`;
      // --- Couleurs ---
      const colorOptions = document.getElementById('colorOptions');
      COLORS.forEach((c, i) => {
        const btn = document.createElement('div');
        btn.className = 'fiche-color' + (i===0 ? ' selected' : '');
        btn.style.background = c.code;
        btn.title = c.name;
        if (c.sup) btn.innerHTML += `<span class='fiche-mat-sup'>+${c.sup}€</span>`;
        btn.onclick = () => {
          selectedColor = c;
          colorOptions.querySelectorAll('.fiche-color').forEach(e=>e.classList.remove('selected'));
          btn.classList.add('selected');
          updatePrice();
        };
        if (i===0) btn.innerHTML += '<span class="check">✓</span>';
        colorOptions.appendChild(btn);
      });
      // Afficher le check sur la couleur sélectionnée
      colorOptions.addEventListener('click', ()=>{
        colorOptions.querySelectorAll('.fiche-color .check').forEach(e=>e.remove());
        const sel = colorOptions.querySelector('.fiche-color.selected');
        if(sel) sel.innerHTML += '<span class="check">✓</span>';
      });
      // --- Matières ---
      const matOptions = document.getElementById('matOptions');
      MATS.forEach((m, i) => {
        const btn = document.createElement('div');
        btn.className = 'fiche-mat' + (i===0 ? ' selected' : '');
        btn.innerHTML = `<span>${m.name}</span>`;
        if (m.sup) btn.innerHTML += `<span class='fiche-mat-sup'>+${m.sup}€</span>`;
        btn.innerHTML += `<span class='fiche-mat-desc'>${m.desc}</span>`;
        btn.onclick = () => {
          selectedMat = m;
          matOptions.querySelectorAll('.fiche-mat').forEach(e=>e.classList.remove('selected'));
          btn.classList.add('selected');
          updatePrice();
        };
        matOptions.appendChild(btn);
      });
      // --- Quantité ---
      const qtySpan = document.getElementById('qty');
      document.getElementById('qtyMinus').onclick = () => {
        if (qty > 1) { qty--; qtySpan.textContent = qty; updatePrice(); }
      };
      document.getElementById('qtyPlus').onclick = () => {
        qty++; qtySpan.textContent = qty; updatePrice();
      };
      // --- Prix dynamique ---
      function updatePrice() {
        let base = article.price || 0;
        let colorSup = selectedColor.sup || 0;
        let matSup = selectedMat.sup || 0;
        let sizeMul = selectedSize.mul || 1;
        let total = (base + colorSup + matSup) * sizeMul * qty;
        document.getElementById('price').textContent = total.toLocaleString('fr-FR', { style: 'currency', currency: 'EUR' });
      }
      updatePrice();
      // --- Ajouter au panier ---
      document.getElementById('addToCart').onclick = function() {
        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const item = {
          title: article.title,
          price: (article.price + (selectedColor.sup||0) + (selectedMat.sup||0)) * (selectedSize.mul||1),
          images: article.images,
          description: article.description,
          color: selectedColor.name,
          mat: selectedMat.name,
          size: selectedSize.name,
          qty: qty
        };
        // Vérifie si déjà dans le panier (même config)
        const idx = cart.findIndex(e => e.title === item.title && e.color === item.color && e.mat === item.mat && e.size === item.size);
        if(idx !== -1) {
          cart[idx].qty += item.qty;
        } else {
          cart.push(item);
        }
        localStorage.setItem('cart', JSON.stringify(cart));
        document.getElementById('addToCart').innerText = 'Ajouté ✓';
        setTimeout(()=>document.getElementById('addToCart').innerText = 'Ajouter au panier', 1200);
      };
      // --- Achat immédiat ---
      document.getElementById('buyNow').onclick = function() {
        const item = {
          title: article.title,
          price: (article.price + (selectedColor.sup||0) + (selectedMat.sup||0)) * (selectedSize.mul||1),
          images: article.images,
          description: article.description,
          color: selectedColor.name,
          mat: selectedMat.name,
          size: selectedSize.name,
          qty: qty
        };
        localStorage.setItem('paiement_article', JSON.stringify(item));
        localStorage.removeItem('paiement_panier');
        window.location.href = 'paiement.html';
      };
      // --- Retour site web ---
      document.getElementById('backToSite').onclick = function() {
        window.location.href = 'index.html#store';
      };
      // --- Description longue ---
      document.getElementById('longDesc').innerHTML = (article.description || '').split('<br>').slice(1).join('<br>') || 'Description détaillée du produit.';
    }
  </script>
</body>
</html>
